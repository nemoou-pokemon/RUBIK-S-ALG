<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomePage Design</title>

     <link rel="manifest" href="manifest.json">
    <link rel="icon" href="/assets/blueRubiksV2.png" type="image/png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <script>
        // Capture the beforeinstallprompt event as early as possible
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('üéâ beforeinstallprompt event captured early!');
            e.preventDefault();
            // Store it globally so the main script can access it
            window.beforeInstallPromptEvent = e;
        });
        
        // Simple service worker registration (early)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => {
                    console.log('‚úÖ Service Worker registered early:', reg);
                })
                .catch(err => {
                    console.error('‚ùå Service Worker failed:', err);
                });
        }
    </script>

    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body{
           background: linear-gradient(white, rgb(218, 218, 218));
        }
        .container {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto; /* centers the container */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.8rem 1rem;
        }
        .box{
            max-width: 765px;
            width: 95%;
            background-color: black;
            border-radius: 50px;
            box-shadow: 0px 0px 10px 2px rgb(112, 112, 112);
            padding: 30px;
        }
        .whiteBoard{
            width: 100%;
            background-color: white;
            border-radius: 6px;
            padding: 0;
        }
        header{
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 1.2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .title{
             font-family: "Poppins", sans-serif;
             font-weight: 600;
             font-size: 2rem;
             color: rgb(0, 0, 75);
             flex-shrink: 0;
        }
        nav{
            display: flex;
            gap: 3.5rem;
            align-items: center;
            flex-wrap: wrap;
        }.nav-links-group{
            display: flex;
            gap: 2.5rem;
        }
        .nav-link {
            font-family: "Poppins", sans-serif;
            font-weight: 600;
            font-size: 1rem;
            color: rgb(0, 0, 75);
            text-decoration: none;
            transition: color 0.3s ease;
            white-space: nowrap;
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            width: 0;
            height: 2px;
            background-color: rgb(0, 0, 75);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }
        .nav-link:hover {
            opacity: 0.8;
        }
        .nav-link:hover::after {
            width: 100%;
            background-color: rgb(50, 50, 150);
        }
         main{
            /* border: 2px solid blue; */
            flex: 1;
            padding: 2rem 1rem 1rem 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }
        .grid-container{
            display: grid;
            width: 100%;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(3, 140px);
            gap: 0.75rem;
        }
        .grid-box{
            border-radius: 6px;
            transition: all 0.15s ease;
        }
        .grid-box:hover{
            transform: scale(0.95);
        }

        .grid-box:nth-child(6){
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }
        .profile {
            font-family: "Poppins", sans-serif;
            font-weight: 500;
            font-size: 1rem;
            color: white;
            background-color: rgb(0, 0, 53);
            border: none;
            border-radius: 50px;
            padding: 0.5rem 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 0.5rem;
            white-space: nowrap;
        }
        .profile:hover {
            transform: translateY(-3px);
        }
        .contact-us{
            font-family: "Poppins", sans-serif;
            font-weight: 500;
            font-size: 0.7rem;
            color: white;
            background-color: rgb(0, 0, 53);
            border: none;
            border-radius: 50px;
            padding: 0.45rem 1.6rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .contact-us:hover {
            transform: translateY(-3px);
        }
        img{
            /* width: 8rem;
            height: 7.5rem; */
            max-width: 90%;
            height: auto;
        }
        .grid-box:nth-child(7){
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }
        .grid-box:nth-child(1) { background-color: #b1b1b1; }
        .grid-box:nth-child(2) { background-color: rgb(0, 0, 53); }
        .grid-box:nth-child(3) { background-color: rgb(0, 0, 53); }
        .grid-box:nth-child(4) { background-color: #b1b1b1; }
        .grid-box:nth-child(5) { background-color: rgb(0, 0, 53); }
        .grid-box:nth-child(6) { background-color: #dadada; }
        .grid-box:nth-child(7) { background-color: #b1b1b1; }
        .grid-box:nth-child(8) { background-color: rgb(0, 0, 53); }
        .grid-box:nth-child(9) { background-color: rgb(0, 0, 53); }
        .grid-box:nth-child(10) { background-color: rgb(0, 0, 53); }
        .grid-box:nth-child(11) { background-color: rgb(0, 0, 53); }
        .grid-box:nth-child(12) { background-color: rgb(0, 0, 53); }

        #installBtn {
            padding: 10px 17px;
            border: none;
            border-radius: 23px;
            color: white;
            background-color: rgb(24, 9, 24);
            font-weight: 600;
            font-family: 'Open Sauce Sans', sans-serif;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            top: 2rem;
            left: 1rem;
        }

        #installBtn:hover {
            background-color: rgb(44, 29, 44);
            transform: translateY(-1px);
        }

        /* Initially hidden - will be shown by JavaScript when PWA is installable */
        .hidden {
            display: none !important;
        }
        body {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }

        body::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        /* Mobile responsiveness */
        @media (max-width: 990px){
             #installBtn{
                top: 0.5rem;
                padding: 7px 15px;
                font-size: 12px;
            }
        }
        @media (max-width: 768px) {
            .container {
                padding: 1rem 0.5rem;
            }
            .box {
                padding: 20px;
                border-radius: 30px;
            }
            header {
                padding: 1rem;
                justify-content: center;
                text-align: center;
            }
            .title {
                font-size: 1.5rem;
                width: 100%;
                margin-bottom: 0.5rem;
            }
            nav {
                gap: 1rem;
                justify-content: center;
                width: 100%;
            }
            .nav-link {
                font-size: 0.9rem;
            }
            .profile {
                font-size: 0.9rem;
                padding: 0.4rem 1.1rem;
                margin-left: 1rem;
            }
            .contact-us{
                font-size: 0.65rem;
                padding: 0.35rem 1.35rem;
            }
            .grid-container{
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(4, 120px);
                gap: 0.6rem;
            }
            #installBtn{
                top: 0.5rem;
                padding: 6.5px 14.5px;
                font-size: 11px;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 1.3rem;
            }
            nav {
                gap: 0.8rem;
                /* Remove flex-direction: column to keep everything in a row */
                justify-content: center;
                align-items: center;
            }
            .nav-links-group {
                display: flex;
                gap: 0.8rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            .profile {
                /* Remove margin-top to keep it inline */
                margin-left: 0.5rem;
                font-size: 0.8rem;
                padding: 0.4rem 1rem;
            }
            .contact-us {
                font-size: 0.5rem;
                padding: 0.35rem 0.9rem;
            }
            .nav-link {
                font-size: 0.8rem;
            }
            .box {
                border-radius: 20px;
                padding: 15px;
            }
            .grid-container{
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(4, 100px);
                gap: 0.45rem;
            }
        }


        
    </style>
</head>
<body>
    <button id="installBtn" class="hidden">Install PWA</button>

    <div class="container">
        
        <div class="box">
            <div class="whiteBoard">
                <header>
                    <h1 class="title">rubiks Alg</h1>
                    <nav>
                        <div class="nav-links-group">
                            <a href="cfop.html" class="nav-link">cfop mtd</a>
                            <a href="#" class="nav-link">history</a>
                            <a href="rubikstore.html" class="nav-link">shop</a>
                        </div>
                        <button class="profile">Profile</button>
                    </nav>
                </header>
                <main>
                    <div class="grid-container">
                        <div class="grid-box"><p></p></div>
                        <div class="grid-box"><p></p></div>
                        <div class="grid-box"><p></p></div>
                        <div class="grid-box"><p></p></div>
                        <div class="grid-box"><p></p></div>
                        <div class="grid-box"><a href="contactMe.html"><button class="contact-us">Contact Us</button></a></div>
                        <div class="grid-box"><img src="/assets/clock.png" alt="" srcset=""></div>
                        <div class="grid-box"><p></p></div>
                        <div class="grid-box"><p></p></div>
                        <div class="grid-box"><p></p></div>
                        <div class="grid-box"><p></p></div>
                        <div class="grid-box"><p></p></div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <script>
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');
        
        console.log('üîç Script loaded, button element:', installBtn);
        
        // Check if beforeinstallprompt already fired (this is the key fix!)
        if (window.beforeInstallPromptEvent) {
            console.log('üéâ Found existing beforeinstallprompt event!');
            deferredPrompt = window.beforeInstallPromptEvent;
            showInstallButton();
        }
        
        function showInstallButton() {
            if (installBtn) {
                installBtn.style.display = 'block';
                installBtn.textContent = 'Install PWA';
                installBtn.classList.remove('hidden');
                console.log('‚úÖ Install button shown');
            }
        }
        // Also listen for future events (in case it fires after page load)
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('üéâ beforeinstallprompt event fired after page load!');
            e.preventDefault();
            deferredPrompt = e;
            window.beforeInstallPromptEvent = e;
            showInstallButton();
        });
        
        // Check PWA requirements
        function checkPWARequirements() {
            console.log('üîç PWA Requirements Check:');
            console.log('- HTTPS:', location.protocol === 'https:' || location.hostname === 'localhost');
            console.log('- Service Worker support:', 'serviceWorker' in navigator);
            console.log('- Current URL:', window.location.href);
            console.log('- Already installed:', window.matchMedia('(display-mode: standalone)').matches);
            
            // Check for manifest
            const manifestLink = document.querySelector('link[rel="manifest"]');
            console.log('- Manifest link found:', !!manifestLink);
            if (manifestLink) {
                console.log('- Manifest href:', manifestLink.href);
            }
        }
         checkPWARequirements();
        
        // Handle button click
        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                console.log('üîµ Button clicked');
                
                if (!deferredPrompt) {
                    console.log('‚ùå No install prompt available');
                    alert('PWA install not available right now. Try refreshing the page.');
                    return;
                }
                
                try {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log('User choice:', outcome);
                    
                    if (outcome === 'accepted') {
                        console.log('‚úÖ PWA installation accepted');
                    }
                } catch (error) {
                    console.error('‚ùå Error with install prompt:', error);
                }
                 
                deferredPrompt = null;
                window.beforeInstallPromptEvent = null;
                installBtn.style.display = 'none';
            });
        }
    </script>



</body>
</html>